<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GitHub Local Chat</title>
    <style>
        body { font-family: sans-serif; max-width: 400px; margin: 20px auto; }
        #box { height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div id="box">Подключение к базе...</div>
    <input type="text" id="n" placeholder="Имя" style="width: 50px;">
    <input type="text" id="m" placeholder="Текст" style="width: 200px;">
    <button id="b">ОК</button>

    <script type="module">
        // Импортируем из ваших ЛОКАЛЬНЫХ файлов
        import { initializeApp } from "./firebase-app.min.js";
        import { getDatabase, ref, push, onChildAdded } from "./firebase-database.min.js";

        const config = {
            apiKey: "AIzaSyBQ8AVQ1D8c0IpDgoRXL0QayaaVktd3_Xg",
            databaseURL: "https://gitchat-2b675-default-rtdb.firebaseio.com",
            projectId: "gitchat-2b675"
        };

        try {
            const app = initializeApp(config);
            const db = getDatabase(app);
            const chatRef = ref(db, "messages");
            const box = document.getElementById("box");

            // Слушаем базу
            onChildAdded(chatRef, (snap) => {
                if (box.innerHTML === "Подключение к базе...") box.innerHTML = "";
                const data = snap.val();
                const div = document.createElement("div");
                div.innerHTML = `<b>${data.name || "Аноним"}:</b> ${data.text}`;
                box.appendChild(div);
                box.scrollTop = 9999;
            });

            // Отправка
            document.getElementById("b").onclick = () => {
                const m = document.getElementById("m");
                if (m.value) {
                    push(chatRef, {
                        name: document.getElementById("n").value || "Аноним",
                        text: m.value
                    });
                    m.value = "";
                }
            };
        } catch (e) {
            document.getElementById("box").innerHTML = "Ошибка инициализации: " + e.message;
        }
    </script>
</body>
</html>
