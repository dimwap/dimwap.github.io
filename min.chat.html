<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>GitHub Chat Fix</title>
    <style>
        body { font-family: sans-serif; max-width: 400px; margin: 20px auto; }
        #box { height: 300px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div id="box">Загрузка...</div>
    <input id="n" placeholder="Имя" style="width: 50px;">
    <input id="m" placeholder="Текст" style="width: 200px;">
    <button id="b">ОК</button>

    <!-- Подключаем как обычные скрипты, НЕ модули -->
    <script src="firebase-app.min.js"></script>
    <script src="firebase-database.min.js"></script>

    <script>
    if (typeof firebase !== 'undefined') {
        var config = {
            apiKey: "AIzaSyBQ8AVQ1D8c0IpDgoRXL0QayaaVktd3_Xg",
            authDomain: "gitchat-2b675.firebaseapp.com",
            databaseURL: "https://gitchat-2b675-default-rtdb.firebaseio.com",
            projectId: "gitchat-2b675"
        };
        
        // Инициализация
        if (!firebase.apps.length) {
            firebase.initializeApp(config);
        }
        
        var database = firebase.database();
        var chatRef = database.ref("messages");

        // Чтение
        chatRef.on("child_added", function(snap) {
            var box = document.getElementById("box");
            if(box.innerHTML === "Загрузка...") box.innerHTML = "";
            var d = snap.val();
            var el = document.createElement("div");
            el.style.padding = "5px";
            el.innerHTML = "<b>" + (d.name || "Аноним") + ":</b> " + d.text;
            box.appendChild(el);
            box.scrollTop = box.scrollHeight;
        });

        // Отправка (переписана для стабильности)
        document.getElementById("b").onclick = function() {
            var msgInput = document.getElementById("m");
            var nameInput = document.getElementById("n");
            var messageText = msgInput.value.trim();
            
            if (messageText) {
                // Создаем новый пустой дочерний узел
                var newPostRef = chatRef.push();
                // Записываем в него данные
                newPostRef.set({
                    name: nameInput.value || "Аноним",
                    text: messageText,
                    time: firebase.database.ServerValue.TIMESTAMP
                }, function(error) {
                    if (error) {
                        alert("Ошибка записи: " + error.message);
                    } else {
                        msgInput.value = ""; // Очистка при успехе
                    }
                });
            }
        };
    } else {
        document.getElementById("box").innerHTML = "Критическая ошибка: библиотеки не загружены!";
    }
</script>

</body>
</html>
